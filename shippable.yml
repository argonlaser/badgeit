language: go

go:
  - 1.8

env:
  - secure: eHc1Vpp7fapmsNj1CFbFefBTm4AiiGpCWrp9tGpEdVcwExGEodmaTDlL9yXtDue3x/EIcrtJqp8BLQjZLVI7zAjeK7Pv2KMNtJ3ECRCaP//HqnTiPxMtchnn0T+GBrLCBAzGYhHnvHgyFtLHSlxQHAegdemnn2QLsTJDl8/VGSw8Tg4CYg+kj5B3TP5ossm8MwaXKUmpyq2ffe+0kacbxs3Ei5Fg1RugiigmsbPK7VJG7HjeLHsMzU4yec4k2HF9lvQX1+4szAIIoY5+RRmv5IrqPRSepTsLHnKG5uDkbyvlS2GxegXSoiOuNs6j2X8IRDxAtGR+BqzCSHqK8tzMCg==

build:
  ci:
    - which go
    - echo $GOROOT
    - echo $GOPATH
    - ls
    - pwd
    - make init
    - go get github.com/tools/godep
    - godep restore
    - make test-formatters
    - make test-contracts
    # Build binary, worker and api
    # - if [ "$IS_PULL_REQUEST" == false ]; then ./build_docker_images.sh; fi

  on_success:
    - export SUCCESS_SMILEY=":green_heart:"
    - ./telegram.sh "CI - Shippable \n Repository - $SHIPPABLE_REPO_SLUG \n Build - $BUILD_NUMBER \n Status - SUCCESS $SUCCESS_SMILEY \n Link - $BUILD_URL"
  on_failure:
    - export FAILURE_SMILEY=":green_heart:"
    - ./telegram.sh "CI - Shippable \n Repository - $SHIPPABLE_REPO_SLUG \n Build - $BUILD_NUMBER \n Status - FAILED $FAILURE_SMILEY \n Link - $BUILD_URL"

integrations:
  hub:
    - integrationName: Vishnu's Docker
      type: docker
      branches:
        only:
          - master
          - dev